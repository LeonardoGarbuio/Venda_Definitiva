<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cardápio - MotoDelivery</title>
    <link rel="stylesheet" href="/static/css/main.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fmotodelive8457back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="min-h-screen bg-background">
    <!-- Sticky Header -->
    <header class="sticky top-0 z-40 bg-white shadow-subtle border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center space-x-3">
                    <div class="bg-primary text-white p-2 rounded-lg">
                        <i class="fas fa-motorcycle text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-heading font-bold text-secondary">MotoDelivery</h1>
                        <p class="text-xs text-text-secondary">Delivery Rápido</p>
                    </div>
                </div>
                
                <!-- Cart Summary -->
                <div class="flex items-center space-x-4">
                    <div id="cartSummary" class="hidden md:flex items-center space-x-2 text-sm text-text-secondary">
                        <i class="fas fa-shopping-cart text-primary"></i>
                        <span id="cartItemCount">0 itens</span>
                        <span class="text-primary font-semibold" id="cartTotal">R$ 0,00</span>
                    </div>
                    
                    <!-- Navigation Links -->
                    <nav class="hidden md:flex items-center space-x-4" id="motoboyNav">
                        <!-- Links serão preenchidos dinamicamente -->
                    </nav>

                    <!-- Mobile Menu Button -->
                    <button class="md:hidden text-text-secondary hover:text-primary" onclick="toggleMobileMenu()">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div id="mobileMenu" class="md:hidden hidden bg-white border-t border-gray-100">
            <div class="px-4 py-3 space-y-3">
                <div class="flex items-center justify-between py-2 border-b border-gray-100">
                    <div class="flex items-center space-x-2 text-sm text-text-secondary">
                        <i class="fas fa-shopping-cart text-primary"></i>
                        <span id="mobileCartItemCount">0 itens</span>
                        <span class="text-primary font-semibold" id="mobileCartTotal">R$ 0,00</span>
                    </div>
                </div>
                <div id="motoboyMobileNav">
                    <!-- Links serão preenchidos dinamicamente -->
                </div>
            </div>
        </div>

        <!-- Category Tabs -->
        <div class="border-t border-gray-100 bg-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex overflow-x-auto scrollbar-hide py-3 space-x-6" id="categoryTabs">
                    <button class="category-tab active flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="all">
                        <i class="fas fa-utensils mr-2"></i>Todos
                    </button>
                    <button class="category-tab flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="burgers">
                        <i class="fas fa-hamburger mr-2"></i>Hambúrgueres
                    </button>
                    <button class="category-tab flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="pizzas">
                        <i class="fas fa-pizza-slice mr-2"></i>Pizzas
                    </button>
                    <button class="category-tab flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="drinks">
                        <i class="fas fa-glass-cheers mr-2"></i>Bebidas
                    </button>
                    <button class="category-tab flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="desserts">
                        <i class="fas fa-ice-cream mr-2"></i>Sobremesas
                    </button>
                    <button class="category-tab flex-shrink-0 px-4 py-2 text-sm font-semibold rounded-full transition-all duration-200" data-category="salads">
                        <i class="fas fa-leaf mr-2"></i>Saladas
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 pb-24">
        <!-- Hero Section -->
        <section class="bg-gradient-to-r from-primary-50 to-accent-50 py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <h2 class="text-2xl md:text-3xl font-heading font-bold text-secondary mb-2">
                        Sabores que chegam até você
                    </h2>
                    <p class="text-text-secondary max-w-2xl mx-auto">
                        Descubra nossa seleção especial de pratos preparados com ingredientes frescos e entregues rapidamente na sua porta
                    </p>
                </div>
            </div>
        </section>

        <!-- Menu Items -->
        <section class="py-8">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div id="menuGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                    {% for item in menu_items %}
                    <div class="menu-item bg-white rounded-lg shadow-subtle overflow-hidden transition-all duration-200 hover:shadow-elevated" data-category="{{ item.category }}">
                        <div class="relative">
                            <img src="https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="{{ item.name }}" class="w-full h-48 object-cover" loading="lazy" />
                            
                            {% if item.category == 'burgers' %}
                                <div class="absolute top-2 left-2 bg-primary text-white px-2 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-hamburger mr-1"></i>Hambúrguer
                                </div>
                            {% elif item.category == 'pizzas' %}
                                <div class="absolute top-2 left-2 bg-primary text-white px-2 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-pizza-slice mr-1"></i>Pizza
                                </div>
                            {% elif item.category == 'drinks' %}
                                <div class="absolute top-2 left-2 bg-primary text-white px-2 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-glass-cheers mr-1"></i>Bebida
                                </div>
                            {% elif item.category == 'desserts' %}
                                <div class="absolute top-2 left-2 bg-primary text-white px-2 py-1 rounded-full text-xs font-semibold">
                                    <i class="fas fa-ice-cream mr-1"></i>Sobremesa
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="p-4">
                            <div class="flex justify-between items-start mb-2">
                                <h3 class="font-heading font-bold text-secondary text-lg">{{ item.name }}</h3>
                                <span class="font-bold text-primary text-lg">R$ {{ item.price|floatformat:2 }}</span>
                            </div>
                            
                            <p class="text-text-secondary text-sm mb-4 line-clamp-2">{{ item.description }}</p>
                            
                            <button class="w-full btn-primary text-sm py-2 add-to-cart-btn" 
                                    data-item-id="{{ item.id }}" 
                                    data-item-name="{{ item.name }}" 
                                    data-item-price="{{ item.price }}">
                                <i class="fas fa-plus mr-2"></i>Adicionar ao Carrinho
                            </button>
                        </div>
                    </div>
                    {% empty %}
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-utensils text-4xl mb-4"></i>
                        <p class="text-lg">Nenhum item disponível no momento</p>
                        <p class="text-sm">Volte mais tarde!</p>
                    </div>
                    {% endfor %}
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden text-center py-12">
                    <div class="inline-flex items-center space-x-2 text-text-secondary">
                        <i class="fas fa-spinner fa-spin text-primary"></i>
                        <span>Carregando cardápio...</span>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="emptyState" class="hidden text-center py-12">
                    <div class="text-text-secondary">
                        <i class="fas fa-search text-4xl mb-4 opacity-50"></i>
                        <p class="text-lg mb-2">Nenhum item encontrado</p>
                        <p class="text-sm">Tente selecionar uma categoria diferente</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Cart Button -->
    <div id="floatingCart" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50 hidden">
        <button onclick="proceedToCheckout()" class="bg-primary text-white px-6 py-3 rounded-full shadow-floating flex items-center space-x-3 transition-all duration-200 hover:scale-105">
            <div class="flex items-center space-x-2">
                <i class="fas fa-shopping-cart"></i>
                <span id="floatingCartCount" class="bg-white text-primary px-2 py-1 rounded-full text-xs font-bold">0</span>
            </div>
            <span class="font-semibold">Finalizar Pedido</span>
            <span id="floatingCartTotal" class="font-bold">R$ 0,00</span>
        </button>
    </div>

    <!-- Item Detail Modal -->
    <div id="itemModal" class="fixed inset-0 z-50 hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 transition-opacity" onclick="closeItemModal()"></div>
        <div class="fixed inset-x-4 top-1/2 transform -translate-y-1/2 bg-white rounded-lg shadow-floating max-w-md mx-auto max-h-[90vh] overflow-y-auto">
            <div id="modalContent">
                <!-- Modal content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-100 py-6 mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center text-text-secondary text-sm">
                <p>&copy; 2025 MotoDelivery. Todos os direitos reservados.</p>
                <p class="mt-1">Delivery rápido e seguro em toda a cidade</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // Menu data from database - items are rendered in HTML

        // Cart state
        let cart = [];
        let currentCategory = 'all';

        // Get CSRF token from cookies
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded');
            setupCategoryTabs();
            updateCartDisplay();
            setupAddToCartButtons();
        });

        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // Setup category tabs
        function setupCategoryTabs() {
            console.log('Setting up category tabs');
            const tabs = document.querySelectorAll('.category-tab');
            console.log('Found tabs:', tabs.length);
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Tab clicked:', this.dataset.category);
                    
                    // Remove active class from all tabs
                    tabs.forEach(t => {
                        t.classList.remove('active', 'bg-primary', 'text-white');
                        t.classList.add('text-text-secondary', 'hover:text-primary', 'hover:bg-primary-50');
                    });
                    
                    // Add active class to clicked tab
                    this.classList.add('active', 'bg-primary', 'text-white');
                    this.classList.remove('text-text-secondary', 'hover:text-primary', 'hover:bg-primary-50');
                    
                    // Filter items
                    currentCategory = this.dataset.category;
                    console.log('Current category set to:', currentCategory);
                    filterMenuItems();
                });
            });

            // Set initial active state
            const activeTab = document.querySelector('.category-tab.active');
            if (activeTab) {
                activeTab.classList.add('bg-primary', 'text-white');
                activeTab.classList.remove('text-text-secondary');
            }
        }

        // Filter menu items
        function filterMenuItems() {
            console.log('Filtering by category:', currentCategory);
            const menuItems = document.querySelectorAll('.menu-item');
            const emptyState = document.getElementById('emptyState');
            let visibleCount = 0;
            
            console.log('Total menu items found:', menuItems.length);
            
            menuItems.forEach(item => {
                const category = item.dataset.category;
                console.log('Item category:', category, 'for item:', item);
                
                if (currentCategory === 'all' || category === currentCategory) {
                    item.style.display = 'block';
                    visibleCount++;
                    console.log('Showing item:', category);
                } else {
                    item.style.display = 'none';
                    console.log('Hiding item:', category);
                }
            });
            
            console.log('Visible items:', visibleCount);
            
            // Show/hide empty state
            if (visibleCount === 0) {
                emptyState.classList.remove('hidden');
                console.log('Showing empty state');
            } else {
                emptyState.classList.add('hidden');
                console.log('Hiding empty state');
            }
        }

        // Open item modal
        function openItemModal(item) {
            const modal = document.getElementById('itemModal');
            const modalContent = document.getElementById('modalContent');
            
            modalContent.innerHTML = `
                <div class="relative">
                    <img 
                        src="${item.image}" 
                        alt="${item.name}"
                        class="w-full h-64 object-cover"
                        onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;"
                    />
                    <button onclick="closeItemModal()" class="absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg hover:bg-gray-50">
                        <i class="fas fa-times text-gray-600"></i>
                    </button>
                </div>
                <div class="p-6">
                    <h3 class="text-2xl font-heading font-bold text-secondary mb-2">${item.name}</h3>
                    <p class="text-text-secondary mb-4">${item.description}</p>
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-3xl font-bold text-primary">R$ ${item.price.toFixed(2)}</span>
                        <button onclick="addToCart(${item.id}, '${item.name}', ${item.price})" class="btn-primary px-6 py-3">
                            <i class="fas fa-plus mr-2"></i>Adicionar ao Carrinho
                        </button>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
        }

        // Close item modal
        function closeItemModal() {
            const modal = document.getElementById('itemModal');
            modal.classList.add('hidden');
        }

        // Setup add to cart buttons
        function setupAddToCartButtons() {
            const buttons = document.querySelectorAll('.add-to-cart-btn');
            buttons.forEach(button => {
                button.addEventListener('click', function() {
                    const itemId = this.dataset.itemId;
                    const itemName = this.dataset.itemName;
                    const itemPrice = parseFloat(this.dataset.itemPrice);
                    
                    addToCart(itemId, itemName, itemPrice);
                });
            });
        }

        // Add item to cart
        function addToCart(itemId, itemName, itemPrice) {
            // Check if item already exists in cart
            const existingItem = cart.find(item => item.id == itemId);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: itemId,
                    name: itemName,
                    price: itemPrice,
                    quantity: 1
                });
            }
            
            // Update cart display
            updateCartDisplay();
            
            // Show success notification
            showNotification(`${itemName} adicionado ao carrinho!`, 'success');
            
            // Save cart to localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
        }

        // Update cart display
        function updateCartDisplay() {
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            // Desktop cart
            document.getElementById('cartItemCount').textContent = `${totalItems} ${totalItems === 1 ? 'item' : 'itens'}`;
            document.getElementById('cartTotal').textContent = `R$ ${formatPrice(totalPrice)}`;
            
            // Mobile cart
            document.getElementById('mobileCartItemCount').textContent = `${totalItems} ${totalItems === 1 ? 'item' : 'itens'}`;
            document.getElementById('mobileCartTotal').textContent = `R$ ${formatPrice(totalPrice)}`;
            
            // Floating cart
            const floatingCart = document.getElementById('floatingCart');
            const floatingCartCount = document.getElementById('floatingCartCount');
            const floatingCartTotal = document.getElementById('floatingCartTotal');
            
            if (totalItems > 0) {
                floatingCart.classList.remove('hidden');
                floatingCartCount.textContent = totalItems;
                floatingCartTotal.textContent = `R$ ${formatPrice(totalPrice)}`;
            } else {
                floatingCart.classList.add('hidden');
            }
        }

        // Proceed to checkout
        function proceedToCheckout() {
            if (cart.length === 0) {
                showNotification('Seu carrinho está vazio!', 'error');
                return;
            }
            
            // Store cart in localStorage
            localStorage.setItem('orderCart', JSON.stringify(cart));
            
            // Redirect to checkout
            window.location.href = '/orders/create/';
        }

        // Format price
        function formatPrice(price) {
            return price.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        // Notification system
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-floating transition-all duration-300 transform translate-x-full`;
            
            if (type === 'success') {
                notification.classList.add('bg-success-100', 'text-success-800', 'border', 'border-success-200');
                notification.innerHTML = `<i class="fas fa-check-circle mr-2"></i>${message}`;
            } else {
                notification.classList.add('bg-error-100', 'text-error-800', 'border', 'border-error-200');
                notification.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>${message}`;
            }
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Close modal on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeItemModal();
            }
        });

        // Scrollbar hide utility
        const style = document.createElement('style');
        style.textContent = `
            .scrollbar-hide {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            .scrollbar-hide::-webkit-scrollbar {
                display: none;
            }
            .line-clamp-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        `;
        document.head.appendChild(style);
    </script>
    <script src="/static/js/motoboy-nav.js"></script>

</body>
</html>
